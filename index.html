<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="https://glitch.com/favicon.ico">

    <title>Layout Shift Terminator</title>

    <link rel="stylesheet" href="/style.css" />
    <script src="/app.js" type="module"></script>
  </head>
  <body>
    <h1>
      Layout Shift Terminator
    </h1>
    
    <noscript>
      <p>
        <em>This app requires JavaScript to be enabled.</em>
      </p>
    </noscript>
    
    <p>
      The following tool allows you to enter arbitrary markup which causes layout shifts (e.g. social embed) in order
      load the markup at various viewport sizes to be able to measure the dimensions at each. With this information it 
      then provides optimized markup with responsive media queries to reduce the amount of layout shifting when the 
      markup is rendered on a loading page.
    </p>
    
    <form action="javascript:"> 
      
      <label for="markup">Layout-shifting markup:</label>
      <textarea id="markup" data-autofocus placeholder="Paste layout shifting HTML here.">
<!--           <blockquote class="twitter-tweet"><p lang="en" dir="ltr">‚õ∫Ô∏èüî• Fun fact: cAMPfire stories are the best stories.<br> <a href="https://twitter.com/CrystalOnScript?ref_src=twsrc%5Etfw">@CrystalOnScript</a>, <a href="https://twitter.com/nainar92?ref_src=twsrc%5Etfw">@nainar92</a>, and Caroline Liu gather around to unbox the Bento developer preview, which allows you to use AMP ‚ö°Ô∏è components everywhere!<br> <br>üì∫ Tune in ‚Üí <a href="https://t.co/RViEFP4AR9">https://t.co/RViEFP4AR9</a> <a href="https://t.co/Ni8B5VNZVz">pic.twitter.com/Ni8B5VNZVz</a></p>&mdash; AMP Project (@AMPhtml) <a href="https://twitter.com/AMPhtml/status/1397995435386679302?ref_src=twsrc%5Etfw">May 27, 2021</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> -->
        
<!--           <img src="https://amp-wp.org/wp-content/uploads/2021/02/kidshappy-600x400.jpg" style="display:block;width:100%;max-height:400px" loading="lazy"> -->

        <div id="example-lazy-iframe" class="presized-embed">
  <iframe id="simulated-embed" width="100%" style="outline:solid 1px gray; border:0; display:block" height="0" loading="lazy" src="https://example.com/"></iframe>
  <script type="module">
    const iframe = document.getElementById('simulated-embed');
    const setSize = () => { iframe.height = iframe.offsetWidth >= 700 ? 400 : 231 }; 
    //const setSize = () => { iframe.style.height = ( iframe.offsetWidth >= 700 ? 400 : 231 ).toString() + 'px' }; 
    //setTimeout( () => { iframe.height = 100;}, 250 );
    //setTimeout( () => { iframe.height = 200;}, 500 );
    setTimeout(setSize, 250);
    window.addEventListener('resize', setSize);
  </script>
</div>

      </textarea>
      <button type="submit" disabled>
        Eliminate Layout Shift
      </button>
      
      <section id="calculation" hidden>
        <h2>
          Terminating Layout Shifts‚Ä¶
        </h2>
        
        <progress></progress>
        
        <p>
          Checking viewport: <span id="current-viewport-width"></span>&times;<span id="current-viewport-height"></span>
        </p>
        
        <div id="iframe-wrapper">
          <iframe src="about:blank"></iframe>
        </div>
      </section>

      <section id="termination" hidden>
        <h2>
          Terminated
        </h2>
        <p hidden>
          Viewport sizes:
        </p>
        <ol id="markup-viewport-sizes" hidden></ol>
        
        <label for="optimized-markup">Markup optimized to terminate layout shifts:</label>
        <textarea id="optimized-markup" readonly></textarea>
        
        <p>
          Preview the optimized markup, try resizing the window and hitting this below reload button perhaps with network throttling enabled and check that the lorem ipsum text doesn't shift around.
        </p>
        <button id="reload-preview" type="button">Reload</button>
        <iframe id="optimized-preview" src="about:blank"></iframe>
      </section>
    </form>
  
    <hr>
    <address><a href="https://weston.ruter.net/">@westonruter</a></address>
  </body>
</html>
